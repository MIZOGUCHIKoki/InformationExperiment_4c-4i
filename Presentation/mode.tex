\section{準仮想化と完全仮想化}
\tocc
\subsection{特権モードと非特権モード}
\begin{frame}[t]{\ftitle}
    \begin{block}{特権モード（カーネルモード）}
        OSにおける核となるプログラムであるカーネルを実行する際に用いられる権限．
    \end{block}
\end{frame}
\subsection{準仮想化と完全仮想化}
\begin{frame}[t]{\ftitle}
    ホストOSとハイパーバイザ型を比較すると，性能的にはハイパーバイザ型が有利．
    ハイパーバイザの中にも\textbf{完全仮想化}と\textbf{準仮想化}がある．
    \begin{block}{完全仮想化}
        ハイパーバイザ上で動作するゲストOSの中身に何も変更を加えないで動作させる方式．
    \end{block}
    ゲストOSからハードウェアをアクセスすると，特権違反の割り込みが発生し，ハイパーバイザ内の例外処理に遷移．
    ゲストOSは実際のハードウェアを模倣した仮想ハードウェア上で動作する．
\end{frame}
\begin{frame}[t]{\ftitle}
    \begin{block}{準仮想化}
        ゲストOSに変更を加えて性能向上を図った方式．
        ゲストOSがあらかじめ特権命令を非特権命令に変換することで，ハイパーバイザでの命令変換時にかかるオーバーヘッドを削減する．
    \end{block}
\end{frame}
\begin{frame}[t]{\ftitle}
    命令\texttt{A}：特権命令\footnote{CPUのステータスを変更したり，オペレーティングシステムを動作させるための命令．}\\
    命令\texttt{X}：非特権命令
    \begin{figure}
        \centering
        \begin{tikzpicture}
            \node[draw,fill=gray!60,minimum height=1cm,align=center,text width=.4\textwidth](vm1){命令\texttt{A}};
            \node[draw,fill=gray!40,minimum height=1cm,align=center,text width=.4\textwidth,below=.5cm of vm1](vmm1){命令\texttt{A}\ \raisebox{.25\baselineskip}{\tikz{\draw[-latex](0,0)--(.5,0)}}\ \texttt{X}};
            \node[draw,fill=gray!20,minimum height=1cm,align=center,text width=.4\textwidth,below=.5cm of vmm1](hw1){命令\texttt{X}};
            \node[anchor=north west,draw,fill=white] at (vm1.north west){\tiny ゲストOS};
            \node[anchor=north west,draw,fill=white] at (vmm1.north west){\fontsize{4pt}{0pt}\selectfont ハイパーバイザ};
            \node[anchor=north west,draw,fill=white] at (hw1.north west){\tiny ハードウェア};
            \node[draw,fill=gray!60,minimum height=1cm,align=center,text width=.4\textwidth,right=.5cm of vm1](vm2){命令\texttt{X}};
            \node[draw,fill=gray!40,minimum height=1cm,align=center,text width=.4\textwidth,below=.5cm of vm2](vmm2){命令\texttt{X}};
            \node[draw,fill=gray!20,minimum height=1cm,align=center,text width=.4\textwidth,below=.5cm of vmm2](hw2){命令\texttt{X}};
            \node[anchor=north west,draw,fill=white] at (vm2.north west){\tiny ゲストOS};
            \node[anchor=north west,draw,fill=white] at (vmm2.north west){\fontsize{4pt}{0pt}\selectfont ハイパーバイザ};
            \node[anchor=north west,draw,fill=white] at (hw2.north west){\tiny ハードウェア};
            \node[below] at (hw1.south){完全仮想化};
            \node[below] at (hw2.south){準仮想化};
            \foreach \u \v in {vm1/vmm1,vmm1/hw1,vm2/vmm2,vmm2/hw2}{
                    \draw[-latex](\u)--(\v);
                }
            \node[align=center,draw,fill=gray!60,rounded corners] at($(vm2.west)+(.6cm,-.5cm)$) {\tiny あらかじめ特権命\\\tiny 令を変換しておく};
            \node[align=center,draw,fill=gray!40,rounded corners] at($(vmm1.east)+(-.8cm,-.5cm)$) {\tiny 特権命令を変換する};
        \end{tikzpicture}
    \end{figure}
\end{frame}